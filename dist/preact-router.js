!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("preact")):"function"==typeof define&&define.amd?define(["preact"],e):t.preactRouter=e(t.preact)}(this,function(t){function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e,n){var r,o=/(?:\?([^#]*))?(#.*)?$/,a=t.match(o),u={};if(a&&a[1])for(var p=a[1].split("&"),c=0;c<p.length;c++){var s=p[c].split("=");u[decodeURIComponent(s[0])]=decodeURIComponent(s.slice(1).join("="))}t=i(t.replace(o,"")),e=i(e||"");for(var f=Math.max(t.length,e.length),h=0;h<f;h++)if(e[h]&&":"===e[h].charAt(0)){var l=e[h].replace(/(^:|[+*?]+$)/g,""),d=(e[h].match(/[+*?]+$/)||b)[0]||"",g=~d.indexOf("+"),y=~d.indexOf("*"),m=t[h]||"";if(!m&&!y&&(d.indexOf("?")<0||g)){r=!1;break}if(u[l]=decodeURIComponent(m),g||y){u[l]=t.slice(h).map(decodeURIComponent).join("/");break}}else if(e[h]!==t[h]){r=!1;break}return(!0===n.default||!1!==r)&&u}function r(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function o(t,e){return t.index=e,t.rank=p(t),t.props}function i(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function a(t){return":"==t.charAt(0)?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}function u(t){return i(t).map(a).join("")}function p(t){return t.props.default?0:u(t.props.path)}function c(t,e){void 0===e&&(e="push"),U&&U[e]?U[e](t):"undefined"!=typeof history&&history[e+"State"]&&history[e+"State"](null,null,t)}function s(){var t;return t=U&&U.location?U.location:U&&U.getCurrentLocation?U.getCurrentLocation():"undefined"!=typeof location?location:k,""+(t.pathname||"")+(t.search||"")}function f(t,e){void 0===e&&(e=!1),"string"!=typeof t&&t.url&&(e=t.replace,t=t.url);var n=h(t);return n&&(t.startsWith(n.baseUrl)||(t=n.baseUrl+t),c(t,e?"replace":"push")),l(t)}function h(t){for(var e=C.length;e--;)if(C[e].canRoute(t))return C[e];return!1}function l(t){for(var e=!1,n=0;n<C.length;n++)!0===C[n].routeTo(t)&&(e=!0);for(var r=x.length;r--;)x[r](t);return e}function d(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),n=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return f(e)}}function g(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||0!==t.button))return d(t.currentTarget||t.target||this),y(t)}function y(t){return t&&(t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault()),!1}function m(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||0!==t.button)){var e=t.target;do{if("A"===(e.nodeName+"").toUpperCase()&&e.getAttribute("href")){if(e.hasAttribute("native"))return;if(d(e))return y(t)}}while(e=e.parentNode)}}function v(){A||("function"==typeof addEventListener&&(U||addEventListener("popstate",function(){l(s())}),addEventListener("click",m)),A=!0)}var b={},U=null,C=[],x=[],k={},A=!1,R=function(a){function u(t,e){var n=this;if(a.call(this,t),this.baseUrl=t.basePath||"",t.path){i(t.path).forEach(function(t){-1==t.indexOf(":")&&(n.baseUrl=n.baseUrl+"/"+t)})}t.history&&(U=t.history),e&&e["preact-router-base"]&&!this.props.base&&(this.baseUrl=e["preact-router-base"]+this.baseUrl),this.state={url:t.url||s()},v()}return a&&(u.__proto__=a),u.prototype=Object.create(a&&a.prototype),u.prototype.constructor=u,u.prototype.getChildContext=function(){return t={},t["preact-router-base"]=this.baseUrl,t;var t},u.prototype.shouldComponentUpdate=function(t){return!0!==t.static||(t.url!==this.props.url||t.onChange!==this.props.onChange)},u.prototype.canRoute=function(e){return this.getMatchingChildren(t.toChildArray(this.props.children),e,!1).length>0},u.prototype.routeTo=function(t){this.setState({url:t});var e=this.canRoute(t);return this.updating||this.forceUpdate(),e},u.prototype.componentWillMount=function(){C.push(this),this.updating=!0},u.prototype.componentDidMount=function(){var t=this;U&&(this.unlisten=U.listen(function(e){t.routeTo(""+(e.pathname||"")+(e.search||""))})),this.updating=!1},u.prototype.componentWillUnmount=function(){"function"==typeof this.unlisten&&this.unlisten(),C.splice(C.indexOf(this),1)},u.prototype.componentWillUpdate=function(){this.updating=!0},u.prototype.componentDidUpdate=function(){this.updating=!1},u.prototype.getMatchingChildren=function(i,a,u){var p=this;return i.filter(o).sort(r).map(function(r){var o=n(a,p.baseUrl+r.props.path,r.props);if(o){if(!1!==u){var i={url:a,matches:o};return e(i,o),delete i.ref,delete i.key,t.cloneElement(r,i)}return r}}).filter(Boolean)},u.prototype.render=function(e,n){var r=e.children,o=e.onChange,i=n.url,a=this.getMatchingChildren(t.toChildArray(r),i,!0),u=a[0]||null,p=this.previousUrl;return i!==p&&(this.previousUrl=i,"function"==typeof o&&o({router:this,url:i,previous:p,active:a,current:u})),u},u}(t.Component),K=function(n){var r=e({},n),o=C.find(function(t){return r.href&&t.canRoute(r.href)});return o&&o.props.basePath&&r.href.indexOf(o.props.basePath)&&(r.href=o.props.basePath+r.href),t.createElement("a",e({onClick:g},r))},O=function(e){return t.createElement(e.component,e)};return R.subscribers=x,R.getCurrentUrl=s,R.route=f,R.Router=R,R.Route=O,R.Link=K,R});
//# sourceMappingURL=preact-router.js.map
